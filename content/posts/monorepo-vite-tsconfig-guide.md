---
title: "Monorepo æ„å»ºç¬”è®°ï¼šVite ä¸ tsconfig è·¯å¾„åŒæ­¥åŠç¯å¢ƒè§£è€¦æŒ‡å—"
date: 2026-02-24
draft: false
description: ""
tags: []
categories: ["ç¬”è®°"]
---

## ğŸ’¡ 1. èƒŒæ™¯ï¼šVite ä¸ TypeScript çš„â€œå‰²è£‚æ„Ÿâ€

åœ¨ç°ä»£å‰ç«¯ Monorepoï¼ˆå¦‚åŸºäº pnpm workspace + Turborepoï¼‰å·¥ç¨‹ä¸­ï¼Œå¸¸å¸¸ä¼šé‡åˆ°è¿™æ ·çš„ç—›ç‚¹ï¼š**ä¿®æ”¹äº†å­åŒ…çš„æºç ï¼Œä½†ä¸»åº”ç”¨æ²¡æœ‰è§¦å‘çƒ­æ›´æ–°ï¼ˆHMRï¼‰ï¼Œå¿…é¡»æ‰‹åŠ¨é‡æ–° Build å­åŒ…ã€‚**

è¿™èƒŒåçš„æ ¹æœ¬åŸå› æ˜¯ TypeScript å’Œ Vite çš„è¿è¡Œé€»è¾‘æ˜¯â€œå„è‡ªä¸ºæ”¿â€çš„ï¼š

* **TypeScript çš„è®¤çŸ¥ (`tsconfig.json`)**ï¼šè´Ÿè´£ IDEï¼ˆå¦‚ VS Codeï¼‰çš„æ™ºèƒ½æç¤ºã€ç±»å‹æ¨å¯¼å’Œè·³è½¬ã€‚å®ƒé€šè¿‡ `paths` å­—æ®µè¯»å–å·¥ä½œåŒºå†…çš„**æºç **ï¼ˆ`.ts`/`.vue`ï¼‰ã€‚æ‰€ä»¥ä½ åœ¨ç¼–è¾‘å™¨é‡ŒæŒ‰ä½ Ctrl ç‚¹å‡»å‡½æ•°ï¼Œèƒ½ç²¾å‡†è·³åˆ°æºç ã€‚
* **Vite çš„è®¤çŸ¥ (`vite.config.ts`)**ï¼šè´Ÿè´£å®é™…çš„ä»£ç ç¼–è¯‘å’Œæ‰“åŒ…ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå®ƒæ ¹æœ¬ä¸çœ‹ `tsconfig.json`ã€‚é‡åˆ° `@bingwu/iip-ui-utils` è¿™æ ·çš„å†…éƒ¨åŒ…æ—¶ï¼Œå®ƒä¼šå» `node_modules` çš„è½¯é“¾æ¥ä¸­è¯»å–è¯¥åŒ… `package.json` æŒ‡å‘çš„ **`dist` äº§ç‰©**ã€‚


## âš™ï¸ 2. æ ¸å¿ƒåŸç†è§£æï¼š`vite-tsconfig-paths` çš„ä½œç”¨

ä¸ºäº†æ¶ˆé™¤è¿™ç§å‰²è£‚æ„Ÿï¼Œæˆ‘ä»¬éœ€è¦å¼•å…¥ `vite-tsconfig-paths` æ’ä»¶ã€‚

**å®ƒçš„æ ¸å¿ƒä½œç”¨æ˜¯å……å½“â€œç¿»è¯‘å®˜â€**ï¼Œå®ç°**â€œå•ä¸€æ•°æ®æºï¼ˆSingle Source of Truthï¼‰â€**ï¼š
å®ƒä¼šåœ¨ Vite å¯åŠ¨æ—¶ï¼Œè‡ªåŠ¨è¯»å– `tsconfig.json` é‡Œçš„ `paths` é…ç½®ï¼Œå¹¶åœ¨åº•å±‚æ‚„æ‚„æŠŠå®ƒä»¬è½¬æ¢æˆ Vite çš„ `resolve.alias`ã€‚è¿™æ ·ä¸€æ¥ï¼ŒVite ä¹Ÿæ‹¥æœ‰äº†å’Œ TS ä¸€æ ·çš„è®¤çŸ¥ï¼Œç›´æ¥å»è¯»å–å­åŒ…çš„**æºç **ï¼Œä»è€Œæ‰“é€šè·¨åŒ…çº§åˆ«çš„ç§’çº§çƒ­æ›´æ–°ã€‚

**å®‰è£…ä¾èµ–ï¼š**

```bash
pnpm add -D vite-tsconfig-paths

```


## ğŸ—ï¸ 3. æ¶æ„ç­–ç•¥ï¼šDev ä¸ Build æ¨¡å¼çš„è§£è€¦

å¯¹äºéœ€è¦æœ€ç»ˆ**å‘å¸ƒåˆ° npm ä¾›å¤–éƒ¨ä½¿ç”¨**çš„â€œå¯æ„å»ºåŒ…ï¼ˆBuildable Packagesï¼‰â€ï¼Œæˆ‘ä»¬ä¸èƒ½åœ¨æ‰€æœ‰ç¯å¢ƒä¸‹éƒ½æ— è„‘è¯»å–æºç ã€‚å¿…é¡»åœ¨ Dev å’Œ Build æ¨¡å¼ä¸‹é‡‡å–æˆªç„¶ä¸åŒçš„ç­–ç•¥ï¼š**å¼€å‘è¯»æºç ï¼ˆè¿½æ±‚é€Ÿåº¦ï¼‰ï¼Œç”Ÿäº§è¯»äº§ç‰©ï¼ˆè¿½æ±‚ç¨³å®šï¼‰ã€‚**

### ğŸŸ¢ Dev æ¨¡å¼ (`vite serve`)ï¼šã€å¿…é¡»è¯»æºç ã€‘

* **è¡Œä¸ºï¼š** å¯ç”¨æ’ä»¶ã€‚ä¸»åº”ç”¨çš„ Vite ç›´æ¥è·¨ç›®å½•ç¼–è¯‘å­åŒ…çš„æºç ã€‚
* **ä¼˜åŠ¿ï¼š** è¿½æ±‚æè‡´çš„å¼€å‘ä½“éªŒã€‚ä¿®æ”¹å­åŒ…ä»£ç ä¿å­˜åï¼Œä¸»åº”ç”¨ç¬é—´çƒ­æ›´æ–°ï¼Œæ— éœ€ç­‰å¾…ä»»ä½•å­åŒ…çš„æ‰“åŒ…æµç¨‹ï¼Œä¸”æ”¯æŒæ— ç¼æ–­ç‚¹è°ƒè¯•ã€‚

### ğŸ”´ Build æ¨¡å¼ (`vite build`)ï¼šã€å¿…é¡»è¯»äº§ç‰©ã€‘

* **è¡Œä¸ºï¼š** ç¦ç”¨æ’ä»¶ã€‚è®©ä¸»åº”ç”¨çš„ Vite è€è€å®å®å»è¯»å–å­åŒ…æ„å»ºå¥½çš„ `dist` ç›®å½•ã€‚
* **æ ¸å¿ƒåŸå› ï¼ˆæå…¶å…³é”®ï¼‰ï¼š**
1. **â€œéªŒæ¯’â€æœºåˆ¶ï¼š** å¦‚æœä¸»åº”ç”¨æ‰“åŒ…æ—¶ä¾ç„¶è¯»æºç ï¼Œå°±ç›¸å½“äºæŠŠå­åŒ…æºç æ‰è¿›äº†ä¸»åº”ç”¨ã€‚ä¸‡ä¸€å­åŒ…è‡ªèº«çš„å¯¼å‡ºé…ç½®ï¼ˆ`exports`ï¼‰æˆ–å¤–éƒ¨åŒ–é…ç½®ï¼ˆ`external`ï¼‰å†™é”™äº†ï¼Œæœ¬åœ°å¼€å‘æ ¹æœ¬å‘ç°ä¸äº†ï¼åªæœ‰æ¶ˆè´¹çœŸå®çš„ `dist`ï¼Œæ‰èƒ½ç¡®ä¿æœ€ç»ˆå‘åˆ° npm çš„åŒ…æ˜¯å®Œå…¨å¯ç”¨çš„ã€‚
2. **Turborepo ç¼“å­˜æœ€å¤§åŒ–ï¼š** åœ¨ `turbo run build` æ—¶ï¼ŒTurbo å…ˆæ„å»ºå­åŒ…ç”Ÿæˆ `dist`ï¼ˆæ— ä¿®æ”¹åˆ™ç§’å‘½ä¸­ç¼“å­˜ï¼‰ã€‚ä¸»åº”ç”¨ç›´æ¥å¤ç”¨è¿™äº› `dist`ï¼Œæå¤§å‡å°‘ Vite çš„ç¼–è¯‘å·¥ä½œé‡ã€‚
3. **äº§ç‰©ä½“ç§¯æ§åˆ¶ï¼š** ç¡®ä¿å­åŒ…è‡ªå·±çš„æ‰“åŒ…è§„åˆ™ï¼ˆå¦‚æ’é™¤ Vueã€Element Plus ç­‰ peerDependenciesï¼‰ä¸¥æ ¼ç”Ÿæ•ˆã€‚



### ğŸ“Š æ¨¡å¼å¯¹æ¯”é€ŸæŸ¥è¡¨

| ç»´åº¦ | Dev æ¨¡å¼ (`command === 'serve'`) | Build æ¨¡å¼ (`command === 'build'`) |
| --- | --- | --- |
| **æ’ä»¶çŠ¶æ€** | å¯ç”¨ | ç¦ç”¨ |
| **Vite è¯»å–ç›®æ ‡** | å­åŒ…çš„**æºç ** (`src/index.ts`) | å­åŒ…çš„**æ‰“åŒ…äº§ç‰©** (`dist/index.js`) |
| **æ ¸å¿ƒè¯‰æ±‚** | ç§’çº§çƒ­æ›´æ–° (HMR)ã€å®Œç¾ç±»å‹è°ƒè¯• | äº§ç‰©å¯é æ€§éªŒè¯ã€åˆ©ç”¨ Turbo ç¼“å­˜æé€Ÿ |
| **å‰ç½®è¦æ±‚** | æ—  | å­åŒ…å¿…é¡»æå‰å®Œæˆ `build` å¹¶ç”Ÿæˆ `dist` |


## ğŸ’» 4. æœ€ä½³å®è·µé…ç½®ä»£ç 

ä¸ºäº†å®ç°ä¸Šè¿°çš„â€œç¯å¢ƒè§£è€¦â€ï¼Œæˆ‘ä»¬éœ€è¦åœ¨ä¸»åº”ç”¨çš„ `vite.config.ts` ä¸­åˆ©ç”¨ Vite æä¾›çš„ `command` å‚æ•°è¿›è¡ŒåŠ¨æ€åŠ¨æ€åŠ è½½ï¼š

```typescript
import { defineConfig } from 'vite';
import vue from '@vitejs/plugin-vue';
import tsconfigPaths from 'vite-tsconfig-paths';

export default defineConfig(({ command }) => {
  return {
    plugins: [
      vue(),
      // æ ¸å¿ƒé­”æ³•ï¼šåªæœ‰åœ¨æœ¬åœ° dev å¯åŠ¨æœåŠ¡æ—¶ï¼Œæ‰ä½¿ç”¨è¯¥æ’ä»¶è¯»å– tsconfig paths (è¯»æºç )
      // åœ¨æ‰§è¡Œ build æ‰“åŒ…å‘½ä»¤æ—¶ï¼Œç¦ç”¨è¯¥æ’ä»¶ï¼Œé€€å›åˆ°è¯»å– node_modules é‡Œçš„ dist (è¯»äº§ç‰©)
      command === 'serve' ? tsconfigPaths() : undefined
    ],
    // å…¶ä»–é…ç½®...
  };
});

```

*(æ­é… `turbo.json` é‡Œçš„ `"dependsOn": ["^build"]`ï¼Œå³å¯å®Œç¾ä¸²è”æ•´ä¸ªè‡ªåŠ¨åŒ–æ„å»ºæµæ°´çº¿ã€‚)*


## âš ï¸ 5. é¿å‘æŒ‡å—ä¸ç»ˆæé™çº§æ–¹æ¡ˆ

å½“å‘ç°é…ç½®äº† `vite-tsconfig-paths` ä½†**çƒ­æ›´æ–°ä¾ç„¶å¤±æ•ˆ**æ—¶ï¼Œè¯·é‡ç‚¹æ’æŸ¥ä»¥ä¸‹é™·é˜±ï¼š

### ğŸš¨ é™·é˜±ï¼š`tsconfig.json` çš„ç›¸å¯¹è·¯å¾„è®¡ç®—ï¼ˆææ˜“è¸©å‘ï¼‰

`paths` é‡Œçš„ç›¸å¯¹è·¯å¾„æ˜¯ä¸¥æ ¼åŸºäº `baseUrl` æ‰€åœ¨ç›®å½•è®¡ç®—çš„ã€‚å¦‚æœä½ çš„ `tsconfig.json` æ”¾åœ¨æŸä¸ªå­åŒ…çš„æ ¹ç›®å½•ä¸‹ï¼ˆä¾‹å¦‚ `apps/ui/tsconfig.json`ï¼‰ï¼Œè€Œä¸æ˜¯æ•´ä¸ª Monorepo çš„æ ¹ç›®å½•ï¼Œå°±å¿…é¡»ä½¿ç”¨ `../` è·³å‡ºå½“å‰å­åŒ…ç›®å½•ã€‚

> âŒ **é”™è¯¯ç¤ºèŒƒ**ï¼ˆæ’ä»¶æŒ‰ç›¸å¯¹è·¯å¾„æ‰¾ä¸åˆ°æºç ï¼Œä¼šé™é»˜å¤±è´¥å¹¶é™çº§è¯»å– distï¼‰ï¼š
> `"@bingwu/iip-ui-utils": ["packages/utils/src/index.ts"]`
> âœ… **æ­£ç¡®ç¤ºèŒƒ**ï¼ˆå‘ä¸Šè·³å‡ºå½“å‰åŒ…ç›®å½•ï¼Œå›åˆ°æ ¹ç›®å½•å†å‘ä¸‹æ‰¾ï¼‰ï¼š
> `"@bingwu/iip-ui-utils": ["../../packages/utils/src/index.ts"]`

### ğŸ“Œ ç»ˆæå®æˆ˜æ–¹æ¡ˆï¼šç¡¬ç¼–ç  Aliasï¼ˆæ¨èå¤‡é€‰æ–¹æ¡ˆï¼‰

åœ¨æå…¶å¤æ‚çš„ Monorepo ç›®å½•ç»“æ„ä¸‹ï¼Œæˆ–è€…å½“ Vite çš„è¿è¡Œç›®å½•è¢«åŠ¨æ€ä¿®æ”¹æ—¶ï¼Œæ’ä»¶çš„è·¯å¾„è§£æå¶å°”ä¼šå­˜åœ¨ç„å­¦å¤±æ•ˆã€‚æ­¤æ—¶ï¼Œ**æœ€ç¨³å¦¥ã€æœ€ç›´ç™½**çš„æ–¹å¼æ˜¯ç›´æ¥æŠ›å¼ƒæ’ä»¶ï¼Œåœ¨ä¸“ç”¨çš„ `vite.dev.config.ts` ä¸­æ‰‹åŠ¨å†™æ­»ç»å¯¹è·¯å¾„ Aliasï¼š

```typescript
import { resolve } from 'path';

export default defineConfig({
  resolve: {
    alias: {
      '@': resolve(__dirname, 'src'),
      // å¼€å‘ç¯å¢ƒä¸‹ï¼Œå¼ºåˆ¶æŒ‡å®šå†…éƒ¨åŒ…è¯»å–æºç ï¼Œå®Œç¾è§¦å‘ HMRï¼Œæ‹’ç»ä¸€åˆ‡é»‘ç›’è§£æé”™è¯¯
      '@bingwu/iip-ui-utils': resolve(__dirname, '../../packages/utils/src/index.ts'),
      '@bingwu/iip-ui-uniapp-utils': resolve(__dirname, '../../packages/uniapp-utils/src/index.ts'),
      '@bingwu/iip-ui-components': resolve(__dirname, '../../packages/components/src/index.ts')
    }
  }
});

```